---
title: "DataVis Class: Final Project Report"
author: "Group 'Data Wizards': Aishe Memetova, Haotian Bu, Jon White, Vitalii Zakhozhyi"
output: html_document
---
<h1 align="center" style="color:blue">Exploring cash use as a transit fare payment in Seattle</h1>

Our group is interested in cash use as fare payment method in the Greater Seattle area.

Using the Seattle Sound Transit Data of October-November 2015, we will try to answer the following questions:
1) Are cash payments still have a big stake in transit fare types among riders in Seattle?
2) What type of fare is the most common given different purpose of trips?
3).....

**Loading neccessary packages, calling dataset and preparing it for analysis**

Loading Data and Describing the Data

```{r linkdata, results='hide', warning=FALSE, message=FALSE}
library(ggplot2)
library(scales)
library(magrittr)
library(dplyr)

linkdata <- read.csv("https://raw.githubusercontent.com/jwhite00/Group-Project-Data-Vis/master/Data/newLinkData.csv", stringsAsFactors=FALSE)
```

**Finalizing the data frame for ggplot**

Getting rid of missing values, calculating frequences, and subsetting

```{r clean}
linkdata_clean <- linkdata %>%
  filter(faretype != "#NULL!")

absol_ft=table(linkdata_clean$faretype, exclude = 'nothing')
names(absol_ft)[2]='Other'
ft_freq=prop.table(absol_ft)*100
ft_freq_df=as.data.frame(ft_freq) 
names(ft_freq_df)=c("faretype","pct")
ft_freq_df_ord=ft_freq_df[order(-ft_freq_df$pct), ]
```

**Building a bar plot using ggplot**

```{r barplot}
cols <- ifelse(ft_freq_df_ord$faretype == "Cash", "red","gray50")

base = ggplot(ft_freq_df_ord, aes(faretype, pct))
ft_plot1 = base + geom_bar(stat="identity", fill=cols, width = 0.75)
ft_plot2 = ft_plot1 + labs(title='Do riders still use cash to pay a transit fare in Seattle?',
                           x ='Type of fare',
                           y = 'Percentage of riders',
                           caption = 'Source: Sound Transit 2015 Onboard Survey Data')
ft_plot3 = ft_plot2 + coord_flip() +
                      scale_y_continuous(limits=c(0,55),
                                         breaks = seq(0, 55, by = 5), 
                                         labels=scales::unit_format(suffix = '%')) +
                      scale_x_discrete(limits=ft_freq_df_ord$faretype)
ft_plot4 = ft_plot3 + geom_text(aes(y = pct,
                                label = paste0(round(pct,2), '%')), 
                                hjust= -0.15, 
                                size = 3)
ft_plot5 = ft_plot4 + theme(panel.background = element_rect(fill = "white", color = "black"),
                            plot.title = element_text(size = 15, hjust = 0.5),
                            plot.caption = element_text(hjust = 1, vjust = -1.2),
                            axis.title.y = element_text(size = 12, hjust = 0.5, vjust = 1.75),
                            axis.title.x = element_text(size = 12, hjust = 0.5, vjust = -1.25))
ft_plot5
```


###################### BIVAR #####################   

Now, we will try to answer what type of fare is the most common given different purpose of trips.


**Cleaning the data and creating the proportion table**

```{r linkdataclean}
linkdata_clean <- linkdata %>%
  filter(faretype != "#NULL!") %>%
  filter(purpose != "#NULL!")

linkincomefare=table(linkdata_clean$faretype, linkdata_clean$purpose)%>%
         prop.table(margin = 2)%>%   # 2 is % by column
         "*"(100)%>%
         round(3)
```

**Creating the dataframe for building the plot**

```{r dflink}
dflink=as.data.frame(linkincomefare)
names(dflink)=c('Fairtype','Purpose','Percent')
dflink_new = dflink %>% 
  mutate(Fairtype = recode(Fairtype, 'FALSE' = "Other")) #recoding FALSE to Other, meaning other type of fare
```

**Building the plot**

```{r barplotfarepurpose}
base  = ggplot(dflink_new, aes(x = reorder(Fairtype, Percent), y = Percent))
bars1 = base + geom_bar(stat = "identity")
bars2 = bars1 + facet_wrap( ~ Purpose ,nrow = 1)
bars3 = bars2 + coord_flip() + 
                scale_y_continuous(limits=c(0,80),
                                  labels=scales::unit_format(suffix = '%'))
bars4 = bars3 + geom_text(aes(y = Percent,
                                  label = paste0(round(Percent,1), '%')), 
                                  hjust= -0.15, 
                                  size = 2.5)
bars5 = bars4 + labs(title='What fare type is the most common given different purpose of trips?',
                     x ='Fare type',
                     caption = 'Source: Sound Transit 2015 Onboard Survey Data')
bars6 = bars5 + theme(axis.text.y = element_text(size=8, angle = 30),
                      axis.text.x = element_text(size=7),
                      plot.title = element_text(size = 12, hjust = 0.5),
                      plot.caption = element_text(hjust = 1, vjust = -1.2),
                      axis.title.y = element_text(size = 11, hjust = 0.5, vjust = 1.75),
                      axis.title.x = element_text(size = 11, hjust = 0.5, vjust = -1.25))
bars6
```


##################### MULTIVAR #################### 




